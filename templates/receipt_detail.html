{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <button class="btn btn-back" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> Назад
    </button>
    <div class="receipt-info">
        <h2>Приёмка #{{ receipt.receipt_number }}</h2>
        <p class="receipt-date">Дата: {{ receipt.receipt_date }}</p>
        {% if receipt.description %}
        <p class="receipt-description">{{ receipt.description }}</p>
        {% endif %}
    </div>
    <button class="btn btn-success" id="exportReceiptBtn">
        <i class="fas fa-file-excel"></i> Экспорт в Excel
    </button>
</div>

<div class="receipt-stats-cards">
    <div class="stat-card">
        <div class="stat-value">{{ receipt.total_products }}</div>
        <div class="stat-label">Всего товаров</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ receipt.total_quantity }}</div>
        <div class="stat-label">Общее количество</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ receipt.created_at[:10] }}</div>
        <div class="stat-label">Дата создания</div>
    </div>
</div>

<div class="items-section">
    <h3>Товары в приёмке</h3>
    
    <div class="items-list">
        {% for item in items %}
        <div class="item-card">
            <div class="item-info">
                <h4>{{ item.product_name }}</h4>
                <p class="item-barcode">Штрих-код: {{ item.barcode or 'Не указан' }}</p>
                <p class="item-quantity">Количество: {{ item.quantity }}</p>
                {% if item.box_name or item.zone_name %}
                <p class="item-location">
                    {% if item.box_name %}Коробка: {{ item.box_name }}{% endif %}
                    {% if item.zone_name %} | Зона: {{ item.zone_name }}{% endif %}
                </p>
                {% endif %}
            </div>
        </div>
        {% else %}
        <p class="no-items">В приёмке нет товаров</p>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('exportReceiptBtn').addEventListener('click', function() {
        window.location.href = `/api/receipts/{{ receipt.id }}/export_excel`;
    });
});
</script>

<style>
.receipt-stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.receipt-stats-cards .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.receipt-stats-cards .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 0.5rem;
}

.receipt-stats-cards .stat-label {
    color: #666;
    font-size: 0.9rem;
}

.items-section {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.items-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.item-card {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1rem;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background: #f8f9fa;
}

.item-info h4 {
    margin: 0 0 0.5rem 0;
    color: #333;
}

.item-barcode, .item-quantity, .item-location {
    color: #666;
    font-size: 0.9rem;
    margin: 0.25rem 0;
}

.no-items {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 2rem;
}
</style>
{% endblock %}